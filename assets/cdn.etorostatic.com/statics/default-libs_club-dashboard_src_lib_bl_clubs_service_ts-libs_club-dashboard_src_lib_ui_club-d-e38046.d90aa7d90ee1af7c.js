"use strict";(self.webpackChunketoro=self.webpackChunketoro||[]).push([["default-libs_club-dashboard_src_lib_bl_clubs_service_ts-libs_club-dashboard_src_lib_ui_club-d-e38046"],{83253:(O,C,n)=>{n.d(C,{Fm:()=>s,ZW:()=>y,wI:()=>g});class s{constructor(u){this.playerLevelId=u.playerLevelId,this.minRealizedEquity=u.minRealizedEquity,this.maxRealizedEquity=u.maxRealizedEquity,this.thresholdPercentageToCurrentTier=u.thresholdPercentToCurrentLevel,this.rank=u.rank,this.name=u.name}set nextClub(u){this._nextClub||(this._nextClub=u)}set prevClub(u){this._prevClub||(this._prevClub=u)}get nextClub(){return this._nextClub}get prevClub(){return this._prevClub}}var y=function(o){return o.ItemClicked="Club Dashboard - Item Clicked",o.PageView="Club Dashboard - Page View",o}(y||{}),g=function(o){return o[o.INTERNAL=4]="INTERNAL",o[o.BRONZE=1]="BRONZE",o[o.SILVER=5]="SILVER",o[o.GOLD=3]="GOLD",o[o.PLATINUM=2]="PLATINUM",o[o.PLATINUM_PLUS=6]="PLATINUM_PLUS",o[o.DIAMOND=7]="DIAMOND",o}(g||{})},42408:(O,C,n)=>{n.d(C,{XR:()=>E});var s=n(89204),y=n(46443),g=n(35157),o=n(75797),u=n(84205),_=n(56196),p=n(23477),D=n(46261),f=n(85237),c=n(83253),h=n(9392),b=n(37580),S=n(88324),A=n(69529),U=n(34727),B=n(82380),R=n(61801),P=n(33614),d=n(43395);let E=(()=>{var m;class I{constructor(e,t,a,i,r,l,v,M){this.interestOnBalanceService=e,this.loggerService=t,this.config=a,this.localizeService=i,this.authService=r,this.pubSubService=l,this.httpClient=v,this.isaAccountService=M,this._excludedClubsIds=[c.wI.INTERNAL],this._realizedEquitySubject=new o.t(0),this.realizedEquityBalance$=this._realizedEquitySubject.asObservable(),this._etoroMoneyBalanceSubject=new o.t(0),this.etoroMoneyBalance$=this._etoroMoneyBalanceSubject.asObservable(),this._etoroMoneyBalanceInUSDSubject=new o.t(0),this.etoroMoneyBalanceInUSD$=this._etoroMoneyBalanceInUSDSubject.asObservable(),this._moneyFarmBalanceInUSDSubject=new o.t(0),this.moneyFarmBalanceInUSD$=this._moneyFarmBalanceInUSDSubject.asObservable(),this._isInterestOnBalanceApprovedSubject=new o.t(!1),this.isInterestOnBalanceApproved$=this._isInterestOnBalanceApprovedSubject.asObservable(),this._requestInterestOnBalanceSubject=new u.B,this.requestInterestOnBalanceSubject$=this._requestInterestOnBalanceSubject.asObservable(),this.offersToIgnoreEmptyState=this.config.dynamics.clubDashboard.offers.offersToIgnoreEmptyState,this._cleanData(),this._initializeSubscriptions(),this.getClubDashboardData()}getClubDashboardData(){var e=this;return(0,s.A)(function*(){return e._clubDashboardDataCache||(e._clubDashboardDataCache=e.fetchClubDashboardData()),e._clubDashboardDataCache})()}fetchClubDashboardData(){var e=this;return(0,s.A)(function*(){try{const t=yield(0,_._)(e.httpClient.get("/api/account/v1/clubs",{params:e.getHttpParams()}));return e.processClubDashboardData(t),{data:t,hasAccess:e._setCurrClub()}}catch{e._clubDashboardDataCache=null}})()}_initializeSubscriptions(){this.pubSubService.subscribe("logout:success",()=>{this._cleanData()}),this.pubSubService.subscribe("app:language:change:success",()=>{this.clearClubDashboardCache()})}getHttpParams(){return(new y.Nl).set("primaryLocale",this.localizeService.language).set("secondaryLocale",this._isWebinarstMajorLanguage()?null:"en-gb").set("country",this.authService.user.country.longAbbreviation)}processClubDashboardData(e){var t;this._setClubsData(e.clubs),this._setRealizedEquity(e.userInfo),this._setEtoroMoneyBalance(e.etoroMoney),this._setMoneyFarmBalance(e.moneyFarm),this.moneyFarmData=e.moneyFarm,this.etoroMoneyData=e.etoroMoney,this.downgradeRiskData=e.downgradeRisk,this.webinarsData=e.webinars,this.userInfo=e.userInfo,this.offers=e.offers,this._interestOnBalance=e.interest,this.setIsInterestOnBalanceApproved((null===(t=this._interestOnBalance)||void 0===t?void 0:t.consentStatus)===h.HX.Approved),this._isInitialized=!0}requestInterestOnBalance(){this._requestInterestOnBalanceSubject.next(!0)}_setMoneyFarmBalance(e){this.moneyFarmData=e,this._moneyFarmBalanceInUSDSubject.next(null==e?void 0:e.balanceInUSD)}getMoneyFarmData(){var e=this;return(0,s.A)(function*(){return e.isaAccountService.flowClubPageShouldDisplayIsaAccountButton().then(t=>{var a;return e.moneyFarmData={...e.moneyFarmData,isEligible:t},e._moneyFarmBalanceInUSDSubject.next(null===(a=e.moneyFarmData)||void 0===a?void 0:a.balanceInUSD),e.moneyFarmData})})()}openIsaMoneyfarmDialog(){this.isaAccountService.flowClubPageHandleClickCta()}clearClubDashboardCache(){this._clubDashboardDataCache=null}isBenefitExistsInCurrentClub(e){var t;if(!this._isInitialized)return!1;const a=Array.isArray(e)?e:[e];return null===(t=this.offers)||void 0===t?void 0:t.currentPlayerLevelAvailableOffers.some(i=>a.includes(Number(i.id)))}isBenefitExistsInHigherClubThanCurrent(e){var t;if(!this._isInitialized||!e)return!1;const a=null===(t=this.offers.staticEligibleOffers.find(l=>l.id===e.toString()))||void 0===t?void 0:t.eligibleClubLevelIds;if(null==a||!a.length)return!1;const i=new Set(a);let r=this.userClub.nextClub;for(;r;){if(i.has(r.playerLevelId))return!0;r=r.nextClub}return!1}isClubTierEligibleForBenefit(e,t){var a,i,r;const l=Array.isArray(t)?t:[t],v=null===(a=this.offers.staticEligibleOffers)||void 0===a?void 0:a.find(M=>l.includes(Number(M.id)));return null!==(i=null==v||null===(r=v.eligibleClubLevelIds)||void 0===r?void 0:r.includes(e))&&void 0!==i&&i}_setClubsData(e){let a;this._clubsById={},this._excludedClubsById={},this._clubsList=[],(0,p.A)(e,i=>i.rank).forEach(i=>{if(-1===this._excludedClubsIds.indexOf(i.playerLevelId)){const r=new c.Fm(i);a&&(a.nextClub=r,r.prevClub=a),this._clubsById[r.playerLevelId]=r,this._clubsList.push(r),a=r}else this._excludedClubsById[i.playerLevelId]=new c.Fm(i)})}_setCurrClub(){const t=this.authService.user.playerLevelId;return this._clubsById[t]?(this.userClub=this._clubsById[t],!0):(this._excludedClubsById[t]&&(this.userClub=this._excludedClubsById[t]),!1)}_logData(e){this.loggerService.info({categories:["clubDashboard"],domain:g.SB.Experience,message:e})}_setRealizedEquity(e){var t,a;if(!e)return void this._logData("user info from club api was undefined");const i=null!==(t=e.realizedEquityWithoutCFD)&&void 0!==t?t:0,r=null!==(a=e.cfdAllowedLeveragesAmount)&&void 0!==a?a:0;0===i&&this._logData("realized equity without cfd from club api was undefined"),0===r&&this._logData("cfd allowed leverages amount from club api was undefined or null"),this._realizedEquitySubject.next(i+r)}_isWebinarstMajorLanguage(){return-1!==(this.config.dynamics.clubDashboard.webcastMajorLanguages||[]).indexOf(this.localizeService.language)}getClubsList(){return this.getClubDashboardData().then(()=>this._clubsList)}updateTotalBalance(){var e=this;return(0,s.A)(function*(){try{const t="/api/account/v1/clubs/userTotalBalance",a=yield(0,_._)(e.httpClient.get(t)),i=[];if(!a)throw new Error("Couldnt get user total balance from the server");const{totalBalance:r,realizedEquityWithoutCFD:l,cfdAllowedLeveragesAmount:v,etoroMoneyDataBalanceInUSD:M,moneyFarmBalanceUSD:x}=a;if(e.tierBalance===r)return e.tierBalance;const w=l+v;if((0,D.A)(w)?e._realizedEquitySubject.next(w):i.push("realizedEquity is not a number"),(0,D.A)(M)?e._etoroMoneyBalanceInUSDSubject.next(M):i.push("etoroMoneyDataBalanceInUSD is not a number"),(0,D.A)(x)?e._moneyFarmBalanceInUSDSubject.next(x):i.push("moneyFarmBalanceUSD is not a number"),i.length)throw new Error(i.join(", "));return a.totalBalance}catch(t){throw e.loggerService.error({categories:["clubDashboard"],domain:g.SB.Experience,message:"Couldnt get user total balance from the server",error:t}),t}})()}progressPercentageToNextClub(e){return this._isInitialized?Math.min(Math.max((this.tierBalance-e.minRealizedEquity)/(e.maxRealizedEquity-e.minRealizedEquity)*100,0),100):0}getMissingFundsForNextClub(){if(!this._isInitialized)return 0;const t=this.getActualUserClubByRealizedEquity().maxRealizedEquity-this.tierBalance;return Math.max(t,0)}getMissingFundsToStayInCurrentClub(){return this._isInitialized?Math.max(this.userClub.minRealizedEquity-this.tierBalance,0):0}getActualUserClubByRealizedEquity(){if(!this._isInitialized)return;let e=this.userClub;if(this.tierBalance>=e.maxRealizedEquity){for(;e&&this.tierBalance>=e.maxRealizedEquity;)e=e.nextClub;e||(e=this._clubsList[this._clubsList.length-1])}else if(this.tierBalance<e.minRealizedEquity){for(;e&&this.tierBalance<e.minRealizedEquity;)e=e.prevClub;e||(e=this._clubsList[0])}return e}isUserCandidateForDowngrade(){var e,t;return!!this._isInitialized&&(null===(e=this.downgradeRiskData)||void 0===e?void 0:e.isAtRisk)&&!(null===(t=this.downgradeRiskData)||void 0===t||!t.daysUntilDowngrade)}getDaysUntilDowngrade(){var e;return null===(e=this.downgradeRiskData)||void 0===e?void 0:e.daysUntilDowngrade}isUserAtRiskFrontCalculation(){return!!this._isInitialized&&this.tierBalance<this.userClub.minRealizedEquity}isUserCandidateForUpgrade(){return!!this._isInitialized&&this.tierBalance>=this.userClub.maxRealizedEquity}isUserCloseEnoughToNextClub(){if(!this._isInitialized)return!1;const t=this.getActualUserClubByRealizedEquity().nextClub;return!t||this.tierBalance+t.minRealizedEquity*(t.thresholdPercentageToCurrentTier/100)>=t.minRealizedEquity}acceptInterest(){return this.interestOnBalanceService.acceptInterest()}declineInterest(){return this.interestOnBalanceService.declineInterest()}getCurrencySymbol(){var e;return(null===(e=this.etoroMoneyAccount)||void 0===e?void 0:e.currencySymbol)||""}_cleanData(){this._isInitialized=!1,this.userClub=null,this._clubsById={},this._clubsList=[],this._excludedClubsById={},this._clubDashboardDataCache=null}getAnalyticsData(){var e=this;return(0,s.A)(function*(){var t;const{isEligible:a,hasAccount:i}=yield e.getMoneyFarmData(),r=a&&!i;return{"Club Tier":e.userClub.name,"Progress Bar Type":e.userClub.playerLevelId===c.wI.BRONZE?"Bronze Club":e.getProgressBarType(),"Progress Bar Amount to Add":Math.ceil(e.getMissingFundsForNextClub()),"Realized Equity Balance":e._realizedEquitySubject.value,"eToro Money Balance":e._etoroMoneyBalanceInUSDSubject.value,"eToro Money Type":e.isUserHasEtoroMoneyAccount?"Activated":(null===(t=e.etoroMoneyData)||void 0===t?void 0:t.eligibilityStatus)===h.So.NotEligible?"Learn More":"Open an Account","Interest on Balance Type":e._isInterestOnBalanceApprovedSubject.value?"Active":"Disable","Open ISA Account - Shown":!!r,...e._getWebinarsAnalyticsData()}})()}_getWebinarsAnalyticsData(){var e,t;return{"Webcasts Events Shown ID":null===(e=this.webinarsData)||void 0===e?void 0:e.upcomingWebinars.map(i=>i.id),"Webcasts Number of Events Shown":(null===(t=this.webinarsData)||void 0===t||null===(t=t.upcomingWebinars)||void 0===t?void 0:t.length)||0}}getProgressBarType(){return this.isUserCandidateForUpgrade()?h.lF.UpgradeTommorow:this.isUserCloseEnoughToNextClub()&&!this.isUserCandidateForDowngrade()?h.lF.UpgradeNow:this.isUserCandidateForDowngrade()?h.lF.StayInYourTier:h.lF.Default}get moneyFarmISABalance(){return this.moneyFarmData?this.moneyFarmData.hasAccount?this.moneyFarmData.balanceInUSD:0:null}get tierBalance(){return this._realizedEquitySubject.value+this._etoroMoneyBalanceInUSDSubject.value+(this.config.dynamics.clubDashboard.shouldDisplayISAMoneyFarm?this.moneyFarmISABalance:0)}get totalInvestedWithAllowedCfd(){var e,t;return this.userInfo?(null!==(e=this.userInfo.totalInvestedWithoutCFD)&&void 0!==e?e:0)+(null!==(t=this.userInfo.cfdAllowedLeveragesAmount)&&void 0!==t?t:0):0}_setEtoroMoneyBalance(e){var t;this.etoroMoneyData=e;const{etoroMoneyBalance:a,etoroMoneyBalanceInUSD:i}=(null===(t=this.etoroMoneyData)||void 0===t||null===(t=t.accounts)||void 0===t?void 0:t.reduce((r,l)=>(r.etoroMoneyBalance+=l.balance,r.etoroMoneyBalanceInUSD+=l.balanceInUSD,r),{etoroMoneyBalance:0,etoroMoneyBalanceInUSD:0}))||{etoroMoneyBalance:0,etoroMoneyBalanceInUSD:0};this._etoroMoneyBalanceSubject.next(a),this._etoroMoneyBalanceInUSDSubject.next(i)}get etoroMoneyBalanceInUSD(){var e;return null!==(e=this._etoroMoneyBalanceInUSDSubject.value)&&void 0!==e?e:0}get isUserHasEtoroMoneyAccount(){var e;return!(null===(e=this.etoroMoneyData)||void 0===e||null===(e=e.accounts)||void 0===e||!e.length)}get etoroMoneyAccount(){var e;return(null===(e=this.etoroMoneyData)||void 0===e?void 0:e.accounts)&&this.etoroMoneyData.accounts[0]}getInterestRate(e){var t;return null!==(t={Silver:this.config.dynamics.clubDashboard.interestOnBalanceSilverRate,Gold:this.config.dynamics.clubDashboard.interestOnBalanceGoldRate,Platinum:this.config.dynamics.clubDashboard.interestOnBalancePlatinumRate,PlatinumPlus:this.config.dynamics.clubDashboard.interestOnBalancePlatinumPlusRate,Diamond:this.config.dynamics.clubDashboard.interestOnBalanceDiamondRate}[e])&&void 0!==t?t:null}getClickEventAnalyticsData(e,t){return{"Club Tier":this.userClub.name,"Progress Bar Amount to Add":Math.ceil(this.getMissingFundsForNextClub()),"Progress Bar Type":this.userClub.playerLevelId===c.wI.BRONZE?"Bronze Club":this.getProgressBarType(),"Element Name":e,"Element Subname":t}}getCurrentClubOffers(){const t=new Map(this.config.dynamics.clubDashboard.offers.preConfiguredClickableOffers.map(a=>[a.id.toString(),a]));return this.offers.currentPlayerLevelAvailableOffers.map(a=>{const i=t.get(a.id);return{...a,isClickable:!!a.offerUrl||!!i,offerUrl:a.offerUrl||(null==i?void 0:i.url),isExternalPage:!!a.offerUrl||(null==i?void 0:i.isExternalPage),selector:null==i?void 0:i.selector,isClaimedByDefault:null==i?void 0:i.isClaimedByDefault}})}getNextClubOffers(){return this.offers.nextPlayerLevelAvailableOffers}updateCurrentClubOffers(e,t,a){let i;const r=(0,f.A)(this.offers.currentPlayerLevelAvailableOffers);i=a?r.find(l=>{var v;return null===(v=l.subOffers)||void 0===v?void 0:v.length}).subOffers:r,i.forEach(l=>{(e.includes(l.id)||e.includes(Number(l.id)))&&(l.statusDescription=t)}),this.offers.currentPlayerLevelAvailableOffers=r}setIsInterestOnBalanceApproved(e){this._isInterestOnBalanceApprovedSubject.next(e)}getIbanAccountCurrency(e){var t;const a=null==e||null===(t=e.accounts)||void 0===t?void 0:t[0];if(!a)return"GBP/EUR";switch(a.region){case h.j.UK:return"GBP";case h.j.Europe:return"EUR";default:return"GBP/EUR"}}}return(m=I).\u0275fac=function(e){return new(e||m)(b.KVO(S.i),b.KVO(A.g),b.KVO(U.R),b.KVO(B.X),b.KVO(P.u),b.KVO(R.R),b.KVO(y.Qq),b.KVO(d.U))},m.\u0275prov=b.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),I})()},15995:(O,C,n)=>{n.d(C,{B:()=>P,D:()=>A.D});var s=n(60316),y=n(27382),g=n(50824),o=n(44774),u=n(29730),_=n(64356),p=n(37580);let D=(()=>{var d;class E{}return(d=E).\u0275fac=function(I){return new(I||d)},d.\u0275mod=p.$C({type:d}),d.\u0275inj=p.G2t({imports:[s.MD]}),E})();var f=n(74052),c=n(89100),h=n(326),b=n(27098),S=n(87908),A=n(46383),U=n(1652),B=n(77280),R=n(34456);let P=(()=>{var d;class E{}return(d=E).\u0275fac=function(I){return new(I||d)},d.\u0275mod=p.$C({type:d}),d.\u0275inj=p.G2t({imports:[s.MD,y.D,b.W.forRoot(),g.Yc,o.Z,u.t,_.R,D,S.xj,f.Ss,c.e,U._,h.m,B.d_,B.q4,B.s7,R.X1,B.Ol]}),E})()},46383:(O,C,n)=>{n.d(C,{D:()=>u});var s=n(37580),y=n(34727),g=n(24191),o=n(91013);let u=(()=>{var _;class p{constructor(f,c){this.config=f,this.analytics=c,this.close=new s.bkB,this.namespace="whatsappAvailabilityPopUp"}ngOnInit(){this.cdnUrl=this.config.dynamics.urls.etoroCdn,this.analytics.eventTrack("Club Dashboard - WhatsApp Availability Dialog Viewed")}confirm(){this.analytics.eventTrack("Club Dashboard - WhatsApp Availability Dialog - Confirm Clicked"),this.close.emit()}}return(_=p).\u0275fac=function(f){return new(f||_)(s.rXU(y.R),s.rXU(g.c))},_.\u0275cmp=s.VBU({type:_,selectors:[["et-whatsapp-availability-popup"]],outputs:{close:"close"},decls:13,vars:11,consts:[[1,"whatsapp-availability-wrapper"],["automation-id","whatsapp-availability-image",1,"et-flex-center"],["media","(max-width: 767px)",3,"srcset"],["media","(min-width: 768px)",3,"srcset"],[3,"src"],[1,"whatsapp-availability-text","ets-plain-text"],[1,"whatsapp-availability-footer","et-flex-center"],["type","button","automation-id","whatsapp-availability-btn-confirm",1,"btn-confirm","ets-button-basic","ets-button-primary","ets-button-big",3,"click"]],template:function(f,c){1&f&&(s.j41(0,"div",0)(1,"div",1)(2,"picture"),s.nrm(3,"source",2)(4,"source",3)(5,"img",4),s.k0s()(),s.j41(6,"div",5),s.EFF(7),s.nI1(8,"translate"),s.k0s(),s.j41(9,"div",6)(10,"button",7),s.bIt("click",function(){return c.confirm()}),s.EFF(11),s.nI1(12,"translate"),s.k0s()()()),2&f&&(s.R7$(3),s.Y8G("srcset",c.cdnUrl+"/web-client/et/img/club-dashboard/contacts-info/whatsapp-availability-image-mobile.svg"),s.R7$(1),s.Y8G("srcset",c.cdnUrl+"/web-client/et/img/club-dashboard/contacts-info/whatsapp-availability-image.svg"),s.R7$(1),s.Y8G("src",c.cdnUrl+"/web-client/et/img/club-dashboard/contacts-info/whatsapp-availability-image.svg",s.B4B),s.R7$(2),s.JRh(s.i5U(8,5,"text",c.namespace)),s.R7$(4),s.SpI("",s.i5U(12,8,"confirmButton",c.namespace)," "))},dependencies:[o.D],styles:[".whatsapp-availability-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:10%;padding-top:10%;text-align:center;background-color:var(--neutral-secondary-bg);border-radius:12px 12px 0 0}@media (min-width: 768px){.whatsapp-availability-wrapper[_ngcontent-%COMP%]{position:static;height:auto;width:640px;max-height:100%;padding:60px 40px;border-radius:6px;overflow:hidden}.whatsapp-availability-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}}picture[_ngcontent-%COMP%]{padding-inline-end:40px}.whatsapp-availability-text[_ngcontent-%COMP%]{text-align:center;margin:16px 65px 38px;display:flex;justify-content:center;align-items:center}@media (min-width: 768px){.whatsapp-availability-text[_ngcontent-%COMP%]{margin:16px 135px 38px}}.whatsapp-availability-footer[_ngcontent-%COMP%]   .btn-confirm[_ngcontent-%COMP%]{max-width:321px}"],changeDetection:0}),p})()}}]);
//# sourceMappingURL=default-libs_club-dashboard_src_lib_bl_clubs_service_ts-libs_club-dashboard_src_lib_ui_club-d-e38046.d90aa7d90ee1af7c.js.map